{"is_source_file": true, "format": "JavaScript", "description": "This JavaScript module provides utility functions for safe access to localStorage, including JSON parsing, storage availability checks, backup and reset mechanisms, version migration, debounced writing, and error reporting for a notes application's front-end. It manages storage schemas and handles errors gracefully.", "external_files": [], "external_methods": ["window.dispatchEvent", "JSON.parse", "JSON.stringify", "window.localStorage.getItem", "window.localStorage.setItem", "window.localStorage.removeItem", "window.addEventListener", "window.removeEventListener", "console.warn", "console.debug"], "published": ["STORAGE_KEY", "isStorageAvailable", "getItemSafe", "setItemSafe", "backupAndReset", "migrateIfNeeded", "createDebouncedStorageWriter", "subscribeToErrors"], "classes": [], "methods": [{"name": "emitError(message, detail)", "description": "Creates and dispatches a custom error event to surface non-fatal storage or migration errors.", "scope": "", "scopeKind": ""}, {"name": "isStorageAvailable()", "description": "Checks if localStorage is available and functional in the current environment.", "scope": "", "scopeKind": ""}, {"name": "safeParseJSON(raw)", "description": "Safely parses JSON strings, returning undefined if parsing fails.", "scope": "", "scopeKind": ""}, {"name": "getItemSafe(key, defaultValue = null)", "description": "Retrieves and parses a JSON value from localStorage, returning a default if unavailable or corrupted.", "scope": "", "scopeKind": ""}, {"name": "setItemSafe(key, value)", "description": "Serializes and stores a value in localStorage, handling errors.", "scope": "", "scopeKind": ""}, {"name": "backupAndReset(key, badValue)", "description": "Backs up a corrupted value with a timestamped key and resets the main key, aiding recovery after errors.", "scope": "", "scopeKind": ""}, {"name": "migrateIfNeeded(payload)", "description": "Handles schema versioning, normalizing data and warning on version mismatches.", "scope": "", "scopeKind": ""}, {"name": "debounce(fn, delay = 300)", "description": "Creates a debounce function to limit the rate of calls to a given function.", "scope": "", "scopeKind": ""}, {"name": "createDebouncedStorageWriter(key, delay = 350)", "description": "Returns a debounced function to write data to localStorage with error handling.", "scope": "", "scopeKind": ""}, {"name": "subscribeToErrors(handler)", "description": "Sets up a listener for internal error events, providing a handler for surface errors externally.", "scope": "", "scopeKind": ""}, {"name": "onError(ev)", "scope": "subscribeToErrors", "scopeKind": "function", "description": "unavailable"}], "calls": ["window.dispatchEvent", "JSON.parse", "JSON.stringify", "window.localStorage.getItem", "window.localStorage.setItem", "window.localStorage.removeItem", "window.addEventListener", "window.removeEventListener", "console.warn", "emitError"], "search-terms": ["localStorage safety", "storage migration", "versioned schema", "error event", "backup corrupt data", "debounced storage write", "storage availability check", "safe JSON parsing"], "state": 2, "file_id": 13, "knowledge_revision": 67, "git_revision": "09db157777a9def5cadb9e92ba30874acf7ce484", "revision_history": [{"30": "09db157777a9def5cadb9e92ba30874acf7ce484"}, {"67": "09db157777a9def5cadb9e92ba30874acf7ce484"}], "ctags": [{"_type": "tag", "name": "ERROR_EVENT", "path": "/home/kavia/workspace/code-generation/local-notes-manager-185853-185873/frontend_react/src/utils/storage.js", "pattern": "/^const ERROR_EVENT = \"app:error\";$/", "language": "JavaScript", "kind": "constant"}, {"_type": "tag", "name": "STORAGE_KEY", "path": "/home/kavia/workspace/code-generation/local-notes-manager-185853-185873/frontend_react/src/utils/storage.js", "pattern": "/^export const STORAGE_KEY = \"notes.app.v1\";$/", "language": "JavaScript", "kind": "constant"}, {"_type": "tag", "name": "backupAndReset", "path": "/home/kavia/workspace/code-generation/local-notes-manager-185853-185873/frontend_react/src/utils/storage.js", "pattern": "/^export function backupAndReset(key, badValue) {$/", "language": "JavaScript", "kind": "function", "signature": "(key, badValue)"}, {"_type": "tag", "name": "createDebouncedStorageWriter", "path": "/home/kavia/workspace/code-generation/local-notes-manager-185853-185873/frontend_react/src/utils/storage.js", "pattern": "/^export function createDebouncedStorageWriter(key, delay = 350) {$/", "language": "JavaScript", "kind": "function", "signature": "(key, delay = 350)"}, {"_type": "tag", "name": "debounce", "path": "/home/kavia/workspace/code-generation/local-notes-manager-185853-185873/frontend_react/src/utils/storage.js", "pattern": "/^function debounce(fn, delay = 300) {$/", "language": "JavaScript", "kind": "function", "signature": "(fn, delay = 300)"}, {"_type": "tag", "name": "emitError", "path": "/home/kavia/workspace/code-generation/local-notes-manager-185853-185873/frontend_react/src/utils/storage.js", "pattern": "/^function emitError(message, detail) {$/", "language": "JavaScript", "kind": "function", "signature": "(message, detail)"}, {"_type": "tag", "name": "getItemSafe", "path": "/home/kavia/workspace/code-generation/local-notes-manager-185853-185873/frontend_react/src/utils/storage.js", "pattern": "/^export function getItemSafe(key, defaultValue = null) {$/", "language": "JavaScript", "kind": "function", "signature": "(key, defaultValue = null)"}, {"_type": "tag", "name": "isStorageAvailable", "path": "/home/kavia/workspace/code-generation/local-notes-manager-185853-185873/frontend_react/src/utils/storage.js", "pattern": "/^export function isStorageAvailable() {$/", "language": "JavaScript", "kind": "function", "signature": "()"}, {"_type": "tag", "name": "migrateIfNeeded", "path": "/home/kavia/workspace/code-generation/local-notes-manager-185853-185873/frontend_react/src/utils/storage.js", "pattern": "/^export function migrateIfNeeded(payload) {$/", "language": "JavaScript", "kind": "function", "signature": "(payload)"}, {"_type": "tag", "name": "notes", "path": "/home/kavia/workspace/code-generation/local-notes-manager-185853-185873/frontend_react/src/utils/storage.js", "pattern": "/^      notes: Array.isArray(payload.notes) ? payload.notes : [],$/", "language": "JavaScript", "kind": "property", "scope": "migrateIfNeeded.working", "scopeKind": "class"}, {"_type": "tag", "name": "onError", "path": "/home/kavia/workspace/code-generation/local-notes-manager-185853-185873/frontend_react/src/utils/storage.js", "pattern": "/^  function onError(ev) {$/", "language": "JavaScript", "kind": "function", "signature": "(ev)", "scope": "subscribeToErrors", "scopeKind": "function"}, {"_type": "tag", "name": "safeParseJSON", "path": "/home/kavia/workspace/code-generation/local-notes-manager-185853-185873/frontend_react/src/utils/storage.js", "pattern": "/^function safeParseJSON(raw) {$/", "language": "JavaScript", "kind": "function", "signature": "(raw)"}, {"_type": "tag", "name": "setItemSafe", "path": "/home/kavia/workspace/code-generation/local-notes-manager-185853-185873/frontend_react/src/utils/storage.js", "pattern": "/^export function setItemSafe(key, value) {$/", "language": "JavaScript", "kind": "function", "signature": "(key, value)"}, {"_type": "tag", "name": "settings", "path": "/home/kavia/workspace/code-generation/local-notes-manager-185853-185873/frontend_react/src/utils/storage.js", "pattern": "/^      settings: typeof payload.settings === \"object\" && payload.settings !== null ? payload.sett/", "language": "JavaScript", "kind": "property", "scope": "migrateIfNeeded.working", "scopeKind": "class"}, {"_type": "tag", "name": "subscribeToErrors", "path": "/home/kavia/workspace/code-generation/local-notes-manager-185853-185873/frontend_react/src/utils/storage.js", "pattern": "/^export function subscribeToErrors(handler) {$/", "language": "JavaScript", "kind": "function", "signature": "(handler)"}, {"_type": "tag", "name": "version", "path": "/home/kavia/workspace/code-generation/local-notes-manager-185853-185873/frontend_react/src/utils/storage.js", "pattern": "/^      version: typeof payload.version === \"number\" ? payload.version : 1,$/", "language": "JavaScript", "kind": "property", "scope": "migrateIfNeeded.working", "scopeKind": "class"}, {"_type": "tag", "name": "working", "path": "/home/kavia/workspace/code-generation/local-notes-manager-185853-185873/frontend_react/src/utils/storage.js", "pattern": "/^    let working = {$/", "language": "JavaScript", "kind": "class", "scope": "migrateIfNeeded", "scopeKind": "class"}], "hash": "4ce2e0bd34da1f067f09ce757fe9e82d", "format-version": 4, "code-base-name": "frontend_react", "filename": "frontend_react/src/utils/storage.js", "fields": [{"name": "notes: Array.isArray(payload.notes) ? payload.notes : [],", "scope": "migrateIfNeeded.working", "scopeKind": "class", "description": "unavailable"}, {"name": "settings: typeof payload.settings === \"object\" && payload.settings !== null ? payload.sett/", "scope": "migrateIfNeeded.working", "scopeKind": "class", "description": "unavailable"}, {"name": "version: typeof payload.version === \"number\" ? payload.version : 1,", "scope": "migrateIfNeeded.working", "scopeKind": "class", "description": "unavailable"}]}